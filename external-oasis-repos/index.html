<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>External OASIS repositories - OSG Operations</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "External OASIS repositories";
    var mkdocs_page_input_path = "external-oasis-repos.md";
    var mkdocs_page_url = "/external-oasis-repos/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> OSG Operations</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../mission/">OSG Operations Mission</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Service Level Agreements</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../SLA/collector/">HTCondor Collector</a>
                </li>
                <li class="">
                    
    <a class="" href="../SLA/myosg/">MyOSG</a>
                </li>
                <li class="">
                    
    <a class="" href="../SLA/oasis-replica/">OASIS</a>
                </li>
                <li class="">
                    
    <a class="" href="../SLA/oim/">OIM</a>
                </li>
                <li class="">
                    
    <a class="" href="../SLA/voms/">VOMS</a>
                </li>
                <li class="">
                    
    <a class="" href="../SLA/xdlogin/">XDLogin</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">External OASIS repositories</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#external-oasis-repositories">External OASIS Repositories</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#requests-to-host-a-repository-on-oasis">Requests to Host a Repository on OASIS</a></li>
        
            <li><a class="toctree-l3" href="#requests-to-change-the-url-of-an-external-repository">Requests to Change the URL of an External Repository</a></li>
        
            <li><a class="toctree-l3" href="#requests-to-remove-an-external-repository">Requests to Remove an External Repository</a></li>
        
            <li><a class="toctree-l3" href="#requests-to-blank-an-external-repository">Requests to Blank an External Repository</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Weekly Minutes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/26Mar2018/">26 March 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/12Mar2018/">12 March 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/05Mar2018/">5 March 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/26Feb2018/">26 February 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/19Feb2018/">19 February 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/12Feb2018/">12 February 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/05Feb2018/">5 February 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/29Jan2018/">29 January 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/22Jan2018/">22 January 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/08Jan2018/">8 January 2018</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/18Dec2017/">18 December 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/11Dec2017/">11 December 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/04Dec2017/">4 December 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/27Nov2017/">27 November 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/20Nov2017/">20 November 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/13Nov2017/">13 November 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/06Nov2017/">6 November 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/30Oct2017/">30 October 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/23Oct2017/">23 October 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/16Oct2017/">16 October 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/09Oct2017/">9 October 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/02Oct2017/">2 October 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/25Sep2017/">25 September 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/18Sep2017/">18 September 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/11Sep2017/">11 September 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/28Aug2017/">28 August 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/21Aug2017/">21 August 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/14Aug2017/">14 August 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/07Aug2017/">07 August 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/31Jul2017/">31 July 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/24Jul2017/">24 July 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/17Jul2017/">17 July 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/10Jul2017/">10 July 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/03Jul2017/">03 July 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/26Jun2017/">26 June 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/19Jun2017/">19 June 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/12Jun2017/">12 June 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/05Jun2017/">05 June 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/22May2017/">22 May 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/15May2017/">15 May 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/08May2017/">8 May 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/01May2017/">1 May 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/24Apr2017/">24 April 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/17Apr2017/">17 April 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/10Apr2017/">10 April 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/03Apr2017/">3 April 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/27Mar2017/">27 March 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/20Mar2017/">20 March 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/13Mar2017/">13 March 2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../WeeklyMinutes/27Feb2017/">27 February 2017</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">OSG Operations</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>External OASIS repositories</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/operations/edit/master/docs/external-oasis-repos.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="external-oasis-repositories">External OASIS Repositories</h1>
<p>We offer hosting of non-OSG CVMFS repositories on OASIS. This means that requests to create, rename, remove, or blanking OASIS repositories will come in as GOC tickets. This document contains instructions for handling those tickets.</p>
<div class="admonition note">
<p class="admonition-title">Also see</p>
<ul>
<li><a href="https://opensciencegrid.github.io/technology/policy/external-oasis-repos/">Policy for OSG Mirroring of External CVMFS repositories</a></li>
<li><a href="https://opensciencegrid.github.io/docs/data/external-oasis-repos/">External OASIS repository</a></li>
</ul>
</div>
<h2 id="requests-to-host-a-repository-on-oasis">Requests to Host a Repository on OASIS</h2>
<ol>
<li>
<p>Ensure that the repository administrator is valid for the VO. This can be done by (a) OSG already having a
    relationship with the person or (b) the contacting the VO manager to find out.  Review the URL and verify verify
    that it is appropriate for the VO.</p>
</li>
<li>
<p>Add the repository URL in OIM under the VO's OASIS repository URLs. This should cause the repository's configuration
    to be added to the GOC Stratum-0 within 15 minutes.</p>
</li>
<li>
<p>If the respository ends in a new domain name <code>domain.name</code>that has not been distributed before, then place a copy of the
    <code>domain.name.pub</code> public key into <code>/srv/etc/keys</code> on both <code>oasis-replica</code> and
    <code>oasis-replica-itb</code>. If you do not have that key, then ask the repository service representative how to obtain it.  In
    order to support CVMFS client versions 2.2.X, also make a symbolic link of <code>domain.name.conf</code>
    <code>/cvmfs/config-osg.opensciencegrid.org/etc/cvmfs/domain.d</code> pointing to <code>default.conf</code>. This symbolic link has to be
    created on the <code>oasis-itb</code> machine's copy of the <code>config-osg.opensciencegrid.org</code> repository and then copied to
    production with the <code>copy_config_osg</code> command on the oasis machine.</p>
</li>
<li>
<p>If the repository name does not match <code>*.opensciencegrid.org</code> or <code>*.osgstorage.org</code>, skip this step and go on to your next step.
    If it does match one of those two patterns, then respond to the ticket to tell the administrator to continue with their next step (their step 4).<br />
    We don't want them to continue before 15 minutes has elapsed after step 2 above, so either wait that much time or tell them the time they may proceed (15 minutes after you updated OIM).
    Then wait until the admin has updated the ticket to indicate that they have completed their step before moving on. </p>
</li>
<li>
<p>Ask the administrator of the BNL stratum 1 John DeStefano also add the new repository.  The BNL Stratum-1 administrator
    should set the service to read from
    <code>http://oasis-replica.opensciencegrid.org:8000/cvmfs/<span style="color:red">example.opensciencegrid.org</span></code>.  When the BNL
    Stratum-1 operator has reported back that the replication is ready, respond to the ticket that the repository is
    fully replicated on the OSG and close the ticket.</p>
</li>
</ol>
<h2 id="requests-to-change-the-url-of-an-external-repository">Requests to Change the URL of an External Repository</h2>
<p>If there is a request to change the URL of an external repository, update the registered value in OIM for the VO in <code>OASIS Repo URLs</code>.<br />
Tell the requester that it is ready 15 minutes after OIM is updated.</p>
<h2 id="requests-to-remove-an-external-repository">Requests to Remove an External Repository</h2>
<ol>
<li>After validating that the ticket submitter is authorized by the VO's OASIS manager, delete the registered value
    for <span style="color:red">example.opensciencegrid.org</span> in OIM for the VO in OASIS Repo URLs.</li>
<li>Add the FNAL and BNL Stratum-1 operators to the ticket and ask them to remove the repository.  Wait for the
    Stratum-1 operators to finish before proceeding.</li>
<li>Run <code>cvmfs_server rmfs -f <span style="color:red">example.opensciencegrid.org</span></code> and <code>rm -r
    /oasissrv/cvmfs/<span style="color:red">example.opensciencegrid.org</span></code> on <code>oasis-replica-itb</code> and <code>oasis-replica</code></li>
<li>Run the following command on <code>oasis-itb</code> and <code>oasis</code>:<pre><code>:::console
rm -r /srv/cvmfs/<span style="color:red">example.opensciencegrid.org</span>
</code></pre>
</li>
</ol>
<h2 id="requests-to-blank-an-external-repository">Requests to Blank an External Repository</h2>
<ol>
<li>If there is a need to shut down the distribution of a repository, run <code>blank_osg_repository</code> on <code>oasis-replica</code> and
    give it the full name of the repository. This will rename the repository directories to a name with the current
    timestamp and replace it with a blank repository.  It includes a step to run on the <code>oasis</code> machine, and attempts to
    do it with <code>ssh</code>, but if that fails it prints instructions on how to finish by logging in to the <code>oasis</code> machine
    manually.</li>
<li>When it is time to put the repository back into production, run <code>unblank_osg_repository</code> on <code>oasis-replica</code> and
    gives it the full name of the repository again. This will find the directory with the old timestamp and put it back
    into service. This step also attempts to <code>ssh</code> to the <code>oasis</code> machine.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../WeeklyMinutes/26Mar2018/" class="btn btn-neutral float-right" title="26 March 2018">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SLA/xdlogin/" class="btn btn-neutral" title="XDLogin"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/operations/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../SLA/xdlogin/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../WeeklyMinutes/26Mar2018/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
